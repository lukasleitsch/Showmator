$(function(){var o=!1,l,e,t=io.connect("http://localhost:63123"),n=$("body"),a=$("#title"),i=$("#text"),s=$("#save"),c=$("#delete"),d=function(o){n.removeClass("on-loading").addClass(o),setTimeout(function(){window.close()},2e3)};s.click(function(){if(!n.hasClass("on-duplicate")&&!n.hasClass("on-blacklist")){var l=o?i:a,s=$.trim(l.val());if(""===s)return void l.on("webkitAnimationEnd animationEnd animationend",function(){l.removeClass("shake")}).addClass("shake");n.addClass("on-loading"),t.emit("addLink",{slug:localStorage.slug,title:s,url:o?!1:e,isText:o?1:0})}}),c.click(function(){n.removeClass("on-duplicate").addClass("on-loading"),t.emit("deleteEntry",{slug:localStorage.slug,publicSlug:localStorage.publicSlug,id:c.data("id")})}),$(".btn-close").click(function(){window.close()}),$(window).keydown(function(l){return o||13!=l.keyCode?o&&13==l.keyCode&&l.metaKey?void s.click():27==l.keyCode?void window.close():void 0:void(n.hasClass("on-duplicate")?c.click():s.click())}),$("#text-only").change(function(){o=$(this).is(":checked"),n.toggleClass("on-text-only",o);var l=o?a:i,e=o?i:a;e.val(l.val())}),$(".link-settings").prop("href",chrome.extension.getURL("options.html")),t.on("findDuplicate",function(o){n.removeClass("on-loading").addClass("on-duplicate"),c.data("id",o.id)}),t.on("addLinkSuccess",function(){d(o?"on-success-text":"on-success-link")}),t.on("deleteEntrySuccess",function(o){o.id==c.data("id")&&d("on-delete")}),"undefined"==typeof localStorage.slug?(n.addClass("on-empty-slug"),$("#link-options").prop("href",chrome.extension.getURL("options.html"))):chrome.tabs.getSelected(null,function(i){l=i.title,e=i.url;var s=!1;localStorage.blacklist&&localStorage.blacklist.split("\n").forEach(function(o){(o==e||o+"/"==e||o==e+"/")&&(s=!0)}),o=e.split("/")[4]===localStorage.publicSlug||s&&localStorage.showTextOnly,o?n.addClass("on-text-only"):(a.val(l),s&&!localStorage.showTextOnly&&n.addClass("on-blacklist"),!o&&localStorage.showTextOnly&&n.addClass("on-text-only-allowed")),t.emit("openPopup",{slug:localStorage.slug,url:e,isText:o?1:0})})});