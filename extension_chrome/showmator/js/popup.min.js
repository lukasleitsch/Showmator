var PopUp=function(){var o={},n="http://localhost:63123",t=13,l=27,e="on-blacklist",a="on-delete",i="on-duplicate",s="on-empty-slug",c="on-loading",d="on-success-link",u="on-success-text",r="on-text-only",g="on-text-only-allowed",f="on-text-only-blacklist",p="addLink",k="addLinkSuccess",C="deleteEntry",h="deleteEntrySuccess",m="findDuplicate",y="openPopup",S=!1,v,x,b=!1,w=io.connect(n),T=$("body"),E=$("#title"),L=$("#text"),U=$("#save"),O=$("#delete"),P=$(".btn-close"),R=$("#text-only"),A=function(o){T.removeClass(c).addClass(o),setTimeout(H,2e3)},D=function(){U.blur(),T.hasClass(i)||T.hasClass(e)||I()},K=function(o){o.target.removeClass("shake")},j=function(){T.removeClass(i).addClass(c),w.emit(C,{slug:localStorage.slug,publicSlug:localStorage.publicSlug,id:O.data("id")})},q=function(o){S||o.keyCode!==t?!S&&o.keyCode===t&&o.metaKey?U.click():o.keyCode===l&&H():M()},z=function(){S=$(this).is(":checked"),T.toggleClass(r,S),N()},B=function(o){T.removeClass(c).addClass(i),O.data("id",o.id)},F=function(){A(S?u:d)},G=function(o){o.id===O.data("id")&&A(a)},H=function(){window.close()},I=function(){var o=S?L:E,n=$.trim(o.val());return""===n?void J(o):(T.addClass(c),void w.emit(p,{slug:localStorage.slug,title:n,url:S?!1:x,isText:S?1:0}))},J=function(o){o.on("webkitAnimationEnd animationEnd animationend",K).addClass("shake")},M=function(){T.hasClass(i)?O.click():U.click()},N=function(){var o=S?E:L,n=S?L:E;n.val(o.val())},Q=function(){T.addClass(s),$("#link-options").prop("href",chrome.extension.getURL("options.html"))},V=function(o){v=o.title,x=o.url,localStorage.blacklist&&localStorage.blacklist.split("\n").some(W),x.split("/")[4]===localStorage.publicSlug?(T.addClass(r),S=!0):b&&localStorage.showTextOnly?T.addClass(r+" "+f):(E.val(v),b&&!localStorage.showTextOnly&&T.addClass(e),!S&&localStorage.showTextOnly&&T.addClass(g)),b=!1,X()},W=function(o){return o===x||o+"/"===x||o===x+"/"?(b=!0,!0):void 0},X=function(){w.emit(y,{slug:localStorage.slug,url:x,isText:S?1:0})},Y=function(){U.on("click",D),O.on("click",j),P.on("click",H),$(window).on("keydown",q),R.on("change",z)},Z=function(){$(".link-settings").prop("href",chrome.extension.getURL("options.html")),"undefined"==typeof localStorage.slug?Q():chrome.tabs.getSelected(null,V)},_=function(){w.on(m,B),w.on(k,F),w.on(h,G)};return o.init=function(){Y(),Z(),_()},o}();PopUp.init();