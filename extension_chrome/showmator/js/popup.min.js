$(function(){var l=!1,o,e,t=io.connect("http://localhost:63123"),n=$("body"),a=$("#title"),i=$("#text"),s=$("#save"),c=$("#delete"),d=function(l){return String(l).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},u=function(l){n.removeClass("on-loading").addClass(l),setTimeout(function(){window.close()},2e3)};s.click(function(){if(!n.hasClass("on-duplicate")&&!n.hasClass("on-blacklist")){var o=l?i:a,s=$.trim(o.val());if(""===s)return void o.on("webkitAnimationEnd animationEnd animationend",function(){o.removeClass("shake")}).addClass("shake");n.addClass("on-loading"),t.emit("addLink",{slug:localStorage.slug,title:d(s),url:l?!1:e,isText:l?1:0})}}),c.click(function(){n.removeClass("on-duplicate").addClass("on-loading"),t.emit("deleteEntry",{slug:localStorage.slug,publicSlug:localStorage.publicSlug,id:c.data("id")})}),$(".btn-close").click(function(){window.close()}),$(window).keydown(function(o){return l||13!=o.keyCode?l&&13==o.keyCode&&o.metaKey?void s.click():27==o.keyCode?void window.close():void 0:void(n.hasClass("on-duplicate")?c.click():s.click())}),$("#text-only").change(function(){l=$(this).is(":checked"),n.toggleClass("on-text-only",l);var o=l?a:i,e=l?i:a;e.val(o.val())}),$(".link-settings").prop("href",chrome.extension.getURL("options.html")),t.on("findDuplicate",function(l){n.removeClass("on-loading").addClass("on-duplicate"),c.data("id",l.id)}),t.on("addLinkSuccess",function(){u(l?"on-success-text":"on-success-link")}),t.on("deleteEntrySuccess",function(l){l.id==c.data("id")&&u("on-delete")}),"undefined"==typeof localStorage.slug?(n.addClass("on-empty-slug"),$("#link-options").prop("href",chrome.extension.getURL("options.html"))):chrome.tabs.getSelected(null,function(i){o=i.title,e=i.url;var s=!1;localStorage.blacklist&&localStorage.blacklist.split("\n").forEach(function(l){(l==e||l+"/"==e||l==e+"/")&&(s=!0)}),l=e.split("/")[4]===localStorage.publicSlug||s&&localStorage.showTextOnly,l?n.addClass("on-text-only"):(a.val(o),s&&!localStorage.showTextOnly&&n.addClass("on-blacklist"),!l&&localStorage.showTextOnly&&n.addClass("on-text-only-allowed")),t.emit("openPopup",{slug:localStorage.slug,url:e,isText:l?1:0})})});