var $result,socket;window.addEventListener("message",function(e){e.source==window&&e.data.type&&"showmatorAdminRequestFromPage"==e.data.type&&($result=$("#"+e.data.listContainerID),socket=io.connect(e.data.socketURL),chrome.runtime.sendMessage({type:"showmatorAdminRequestFromScript",publicSlug:e.data.publicSlug},function(e){if(!localStorage.hideTextHint){var t=e.shortcut?" (<em>"+e.shortcut+"</em>)":"",n='<div id="add-text-hint" class="alert alert-warning alert-dismissible"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Schließen</span></button><p><strong>Tipp:</strong> Um einen Texteintrag (ohne Link) hinzuzufügen, kannst du das Icon der Showmator-Erweiterung neben der Adressleiste klicken oder einen Tastatur-Shortcut'+t+' verwenden. Den Shortcut kannst du <a href="chrome://extensions/configureCommands">hier</a> ändern.</p></div>';$result.before(n);var i=$("#add-text-hint");i.find("button").click(function(){i.slideUp(200,function(){localStorage.hideTextHint=!0,i.remove()})}),i.find("a").click(function(e){e.preventDefault(),chrome.runtime.sendMessage({type:"showmatorConfigureShortcut"})})}var s=e.slug,o='<div class="admin-btn-wrapper"><button class="btn btn-default btn-xs btn-edit"><span class="glyphicon glyphicon-pencil"></span></button><button class="btn btn-default btn-xs btn-delete"><span class="glyphicon glyphicon-trash"></span></button></div>',a=!1,r=0,l=function(e){13==e.keyCode&&(e.preventDefault(),$result.find(".editing").find(".btn-edit").click())},d=function(e,t){(t||e&&27==e.which)&&$result.find(".editing").find(".btn-delete").click()};$result.on("click",".btn-edit, .btn-delete",function(e){e.preventDefault();var t=$(this),n=t.closest(".entry"),i=n.find(".entry-text"),o=t.closest(".admin-btn-wrapper"),c=o.find(".glyphicon-pencil, .glyphicon-ok"),u=o.find(".glyphicon-trash, .glyphicon-remove"),p=n.prop("id").split("-")[1],h=function(){a=!a,r=a?p:0,o.toggleClass("editing"),u.toggleClass("glyphicon-trash glyphicon-remove"),c.toggleClass("glyphicon-pencil glyphicon-ok").parent().toggleClass("btn-default btn-primary")},g=function(e){var t=document.createRange(),n=window.getSelection(),i=e.childNodes[0];t.setStart(i,i.length),n.removeAllRanges(),n.addRange(t)},m=function(){var e=i.prop("contenteditable",!0).on("keydown.saveOnEnter",l).focus().text();i.data("text-before",e),document.addEventListener("keydown",d,!0),h(),g(i[0])},f=function(){i.prop("contenteditable",!1).off("keydown.saveOnEnter").blur(),document.removeEventListener("keydown",d,!0),h()};a&&r>0&&p!=r&&d(!1,!0),t.hasClass("btn-edit")?c.hasClass("glyphicon-pencil")?m():(f(),socket.emit("updateEntryTitle",{id:p,title:i.text(),slug:s})):u.hasClass("glyphicon-trash")&&window.confirm("Wirklich löschen?")?socket.emit("deleteEntry",{slug:s,id:p}):u.hasClass("glyphicon-remove")&&(f(),i.text(i.data("text-before")))}).find(".entry-text").after(o),window.postMessage({type:"showmatorAdminResponseFromScript",adminHtml:o},"*")}))},!1);