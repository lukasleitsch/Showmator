var adminBtns=function(){var n={},t,e,i=!1,o=0,a,s,c,r,d,l,u,p,f=function(n){n.source===window&&n.data.type&&"showmatorAdminRequestFromPage"===n.data.type&&(v(n),w(n))},h=function(){t.slideUp(200,function(){localStorage.hideTextHint=!0,t.remove()})},g=function(n){n.preventDefault(),chrome.runtime.sendMessage({type:"showmatorConfigureShortcut"})},m=function(n){n.preventDefault();var t=$(this);A(t),i&&o>0&&p!==o&&T(!1,!0),t.hasClass("btn-edit")?M():U()},b=function(n){return'<div id="add-text-hint" class="alert alert-warning alert-dismissible"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Schließen</span></button><p><strong>Tipp:</strong> Um einen Texteintrag (ohne Link) hinzuzufügen, kannst du das Icon der Showmator-Erweiterung neben der Adressleiste klicken oder einen Tastatur-Shortcut'+n+' verwenden. Den Shortcut kannst du <a href="chrome://extensions/configureCommands">hier</a> ändern.</p></div>'},y=function(){return'<div class="admin-btn-wrapper"><button class="btn btn-default btn-xs btn-edit"><span class="glyphicon glyphicon-pencil"></span></button><button class="btn btn-default btn-xs btn-delete"><span class="glyphicon glyphicon-trash"></span></button></div>'},v=function(n){a=$("#"+n.data.listContainerID),s=io.connect(n.data.socketURL)},w=function(n){chrome.runtime.sendMessage({type:"showmatorAdminRequestFromScript",publicSlug:n.data.publicSlug},k)},k=function(n){x(n.shortcut),e=n.slug,E(),q(),z()},x=function(n){localStorage.hideTextHint||(S(n),C())},S=function(n){var e=n?" (<em>"+n+"</em>":"",i=b(e);a.before(i),t=$("#add-text-hint")},C=function(){t.find("button").on("click",h),t.find("a").on("click",g)},E=function(){a.on("click",".btn-edit, .btn-delete",m)},R=function(n){13===n.keyCode&&(n.preventDefault(),a.find(".editing").find(".btn-edit").click())},T=function(n,t){(t||n&&27===n.which)&&a.find(".editing").find(".btn-delete").click()},A=function(n){c=n.closest(".entry"),r=c.find(".entry-text"),d=n.closest(".admin-btn-wrapper"),l=d.find(".glyphicon-pencil, .glyphicon-ok"),u=d.find(".glyphicon-trash, .glyphicon-remove"),p=c.prop("id").split("-")[1]},D=function(){i=!i,o=i?p:0,d.toggleClass("editing"),u.toggleClass("glyphicon-trash glyphicon-remove"),l.toggleClass("glyphicon-pencil glyphicon-ok").parent().toggleClass("btn-default btn-primary")},L=function(n){var t=document.createRange(),e=window.getSelection(),i=n.childNodes[0];t.setStart(i,i.length),e.removeAllRanges(),e.addRange(t)},F=function(){var n=r.prop("contenteditable",!0).on("keydown.saveOnEnter",R).focus().text();r.data("text-before",n),document.addEventListener("keydown",T,!0),D(),L(r[0])},H=function(){r.prop("contenteditable",!1).off("keydown.saveOnEnter").blur(),document.removeEventListener("keydown",T,!0),D()},M=function(){l.hasClass("glyphicon-pencil")?F():(H(),s.emit("updateEntryTitle",{id:p,title:r.text(),slug:e}))},U=function(){u.hasClass("glyphicon-trash")&&window.confirm("Wirklich löschen?")?s.emit("deleteEntry",{slug:e,id:p}):u.hasClass("glyphicon-remove")&&(H(),r.text(r.data("text-before")))},q=function(){a.find(".entry-text").after(y())},z=function(){window.postMessage({type:"showmatorAdminResponseFromScript",adminHtml:y()},"*")},B=function(){window.addEventListener("message",f,!1)};return n.init=function(){B()},n}();adminBtns.init();