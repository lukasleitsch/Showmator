var adminBtns=function(){var n={},t,e,i,o=!1,a=0,s,c,r,d,l,u,p,f,h=function(n){n.source==window&&n.data.type&&"showmatorAdminRequestFromPage"===n.data.type&&(w(n),k(n))},g=function(){t.slideUp(200,function(){localStorage.hideTextHint=!0,t.remove()})},m=function(n){n.preventDefault(),chrome.runtime.sendMessage({type:"showmatorConfigureShortcut"})},b=function(n){n.preventDefault();var t=$(this);D(t),o&&a>0&&f!=a&&A(!1,!0),t.hasClass("btn-edit")?U():q()},y=function(n){return'<div id="add-text-hint" class="alert alert-warning alert-dismissible"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Schließen</span></button><p><strong>Tipp:</strong> Um einen Texteintrag (ohne Link) hinzuzufügen, kannst du das Icon der Showmator-Erweiterung neben der Adressleiste klicken oder einen Tastatur-Shortcut'+n+' verwenden. Den Shortcut kannst du <a href="chrome://extensions/configureCommands">hier</a> ändern.</p></div>'},v=function(){return'<div class="admin-btn-wrapper"><button class="btn btn-default btn-xs btn-edit"><span class="glyphicon glyphicon-pencil"></span></button><button class="btn btn-default btn-xs btn-delete"><span class="glyphicon glyphicon-trash"></span></button></div>'},w=function(n){s=$("#"+n.data.listContainerID),c=io.connect(n.data.socketURL)},k=function(n){chrome.runtime.sendMessage({type:"showmatorAdminRequestFromScript",publicSlug:n.data.publicSlug},x)},x=function(n){i=n,S(),e=i.slug,R(),z(),B()},S=function(){localStorage.hideTextHint||(C(i.shortcut),E())},C=function(n){var e=n?" (<em>"+n+"</em>":"",i=y(e);s.before(i),t=$("#add-text-hint")},E=function(){t.find("button").on("click",g),t.find("a").on("click",m)},R=function(){s.on("click",".btn-edit, .btn-delete",b)},T=function(n){13===n.keyCode&&(n.preventDefault(),s.find(".editing").find(".btn-edit").click())},A=function(n,t){(t||n&&27===n.which)&&s.find(".editing").find(".btn-delete").click()},D=function(n){r=n.closest(".entry"),d=r.find(".entry-text"),l=n.closest(".admin-btn-wrapper"),u=l.find(".glyphicon-pencil, .glyphicon-ok"),p=l.find(".glyphicon-trash, .glyphicon-remove"),f=r.prop("id").split("-")[1]},L=function(){o=!o,a=o?f:0,l.toggleClass("editing"),p.toggleClass("glyphicon-trash glyphicon-remove"),u.toggleClass("glyphicon-pencil glyphicon-ok").parent().toggleClass("btn-default btn-primary")},F=function(n){var t=document.createRange(),e=window.getSelection(),i=n.childNodes[0];t.setStart(i,i.length),e.removeAllRanges(),e.addRange(t)},H=function(){var n=d.prop("contenteditable",!0).on("keydown.saveOnEnter",T).focus().text();d.data("text-before",n),document.addEventListener("keydown",A,!0),L(),F(d[0])},M=function(){d.prop("contenteditable",!1).off("keydown.saveOnEnter").blur(),document.removeEventListener("keydown",A,!0),L()},U=function(){u.hasClass("glyphicon-pencil")?H():(M(),c.emit("updateEntryTitle",{id:f,title:d.text(),slug:e}))},q=function(){p.hasClass("glyphicon-trash")&&window.confirm("Wirklich löschen?")?c.emit("deleteEntry",{slug:e,id:f}):p.hasClass("glyphicon-remove")&&(M(),d.text(d.data("text-before")))},z=function(){s.find(".entry-text").after(v())},B=function(){window.postMessage({type:"showmatorAdminResponseFromScript",adminHtml:v()},"*")},I=function(){window.addEventListener("message",h,!1)};return n.init=function(){I()},n}();adminBtns.init();